<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Mi Progreso</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding progreso-page">
  <!-- ðŸ”¹ Lista de planes -->
  <ion-list *ngIf="planes.length > 0; else sinPlanes">
    <ion-item
      *ngFor="let plan of planes"
      (click)="abrirDetalle(plan)"
      [class.completado]="plan.completado"
    >
      <ion-label>
        <h2>{{ plan.plan.nombre }}</h2>
        <p>DÃ­a: {{ getDiaSemana(plan.plan.dia_semana) }}</p>
        <ion-badge color="{{ plan.completado ? 'success' : 'warning' }}">
          {{ plan.completado ? 'Completado' : 'En progreso' }}
        </ion-badge>
      </ion-label>
    </ion-item>
  </ion-list>

  <ng-template #sinPlanes>
    <p class="text-center">AÃºn no tienes planes de entrenamiento asignados.</p>
  </ng-template>

  <!-- ðŸ”¹ Modal Detalle -->
  <ion-modal [isOpen]="modalAbierto" (didDismiss)="cerrarModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>{{ planSeleccionado?.plan?.nombre }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <h3>DÃ­a: {{ getDiaSemana(planSeleccionado?.plan?.dia_semana) }}</h3>

        <ion-list>
          <ion-item
            *ngFor="let detalle of ejerciciosPlan"
            [class.completado]="detalle.completado"
          >
            <ion-label>
              <h2>{{ detalle.ejercicio.nombre }}</h2>
              <p>
                {{ detalle.series }} series Ã— {{ detalle.repeticiones }} reps
                <span *ngIf="detalle.peso_kg"> | {{ detalle.peso_kg }} kg</span>
              </p>
            </ion-label>
            <ion-button
              color="success"
              fill="outline"
              size="small"
              (click)="marcarEjercicio(detalle)"
              [disabled]="detalle.completado"
            >
              {{ detalle.completado ? 'âœ”' : 'Marcar' }}
            </ion-button>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
